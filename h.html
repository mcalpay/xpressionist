<!DOCTYPE html>
<html>
<head>
<title>Homrium</title>
</head>
<body>
	<canvas id="c" width="400" height="300" />
<script>
// a 2d coordinate system 
function World() {
}

// Mood of a human
function Mood() {
	this.color = "rgb(0,0,0)"
}

Mood.prototype.color = function() {
	return this.color;
}
	
function Human() {
}

Human.prototype.paint = function() {
}

function Head() {
	this.outline = {
		w 		: 100,
		h 		: 150,
		x		: 10,
		y		: 10,
		fillStyle : "rgb(255,0,0)"
	}
	this.mouth = {
		w 		: this.outline.w*0.5,
		h 		: this.outline.h*0.125,
		x		: this.outline.x + this.outline.w*0.25,
		y		: this.outline.y + this.outline.h*0.75,
		fillStyle : "rgb(0,0,0)"
	}
	this.lefteye = {
		w 		: this.outline.h*0.125,
		h 		: this.outline.h*0.125,
		x		: this.outline.x + this.outline.w*0.25,
		y		: this.outline.y + this.outline.h*0.5,
		fillStyle : "rgb(0,0,0)"
	}
	this.righteye = {
		w 		: this.outline.h*0.125,
		h 		: this.outline.h*0.125,
		x		: this.outline.x + this.outline.w*0.75,
		y		: this.outline.y + this.outline.h*0.5,
		fillStyle : "rgb(0,0,0)"
	}
}

Head.prototype.paint = function(ctx) {
	ctx.fillStyle = this.outline.fillStyle;
	ctx.fillRect (this.outline.x, this.outline.y, this.outline.w, this.outline.h);
	ctx.fillStyle = this.lefteye.fillStyle;
	ctx.fillRect (this.lefteye.x, this.lefteye.y, this.lefteye.w, this.lefteye.h);
	ctx.fillStyle = this.righteye.fillStyle;
	ctx.fillRect (this.righteye.x, this.righteye.y, this.righteye.w, this.righteye.h);
	ctx.fillStyle = this.mouth.fillStyle;				
	ctx.fillRect (this.mouth.x, this.mouth.y, this.mouth.w, this.mouth.h);
}

function Eye(xy) {
	this.xy = xy;
	this.lookFront();
}

Eye.prototype.paint = function(ctx) {
	ctx.fillStyle = this.xy.c;				
	ctx.fillRect(this.xy.x, this.xy.y, this.xy.w, this.xy.h);	
	ctx.fillStyle = "rgb(255,255,255)";
	ctx.fillRect(this.look.x, this.look.y, this.look.w, this.look.h);	
	return this;
}

Eye.prototype.lookFront = function() {
	this.look = {
		x: this.xy.x + this.xy.w*0.3, y: this.xy.y + this.xy.h*0.3, w: this.xy.w*0.4, h: this.xy.h*0.4,
		c: "rgb(255,255,255)"
	}
	return this;
}

Eye.prototype.lookLeft = function() {
	this.look.x = this.xy.x + this.xy.w*0.1;
	return this;
}

Eye.prototype.lookRight = function() {
	this.look.x = this.xy.x + this.xy.w*0.5;
	return this;
}

Eye.prototype.lookTop = function() {
	this.look.y = this.xy.y + this.xy.h*0.1;
	return this;
}

Eye.prototype.lookDown = function() {
	this.look.y = this.xy.y + this.xy.h*0.5;
	return this;
}

Eye.prototype.close = function() {
	this.look.w = 0;
	this.look.h = 0;
	return this;
}

Eye.prototype.open = function() {
	this.look.w = this.xy.w*0.4;
	this.look.h = this.xy.h*0.4;
	return this;
}

function Eyes(left) {
	this.left = left;
	this.right = new Eye({x:left.xy.x + left.xy.w*2, y:left.xy.y, w:left.xy.w, h:left.xy.h, c:left.xy.c});
	new Eyebrow({x:10, y:1, w:10, h:6, c:"rgb(0,0,0)"})
}

Eyes.prototype.paint = function(ctx) {
	this.left.paint(ctx);
	this.right.paint(ctx)
	return this;
}

Eyes.prototype.lookFront = function() {
	this.left.lookFront();
	this.right.lookFront();
	return this;
}

Eyes.prototype.lookLeft = function() {
	this.left.lookLeft();
	this.right.lookLeft();
	return this;
}

Eyes.prototype.lookRight = function() {
	this.left.lookRight();
	this.right.lookRight();
	return this;
}

Eyes.prototype.lookTop = function() {
	this.left.lookTop();
	this.right.lookTop();
	return this;
}

Eyes.prototype.lookDown = function() {
	this.left.lookDown();
	this.right.lookDown();
	return this;
}

Eyes.prototype.close = function() {
	this.left.close();
	this.right.close();
	return this;
}

Eyes.prototype.open = function() {
	this.left.open();
	this.right.open();
	return this;
}

function Eyebrow(xy) {
	this.xy = xy;
	this.normal();
}

Eyebrow.prototype.paint = function(ctx) {
	var xy = this.xy;
	var curve = this.curve;
	ctx.beginPath();
    ctx.moveTo(curve.x1, curve.y1);
    ctx.quadraticCurveTo(curve.x2, curve.y2, curve.x3, curve.y3);
    ctx.lineWidth = xy.h*0.4;
    ctx.strokeStyle = xy.c;
    ctx.stroke();
	return this;
}

Eyebrow.prototype.normal = function() {
	var xy = this.xy;
	this.curve = {x1: xy.x, y1: xy.y + xy.h, x2: xy.x + xy.w*0.5, y2: xy.y + xy.h * 0.9,
					x3: xy.x  + xy.w, y3: xy.y + xy.h
				}
	return this;
}

Eyebrow.prototype.up = function() {
	var xy = this.xy;
	this.curve = {x1: xy.x, y1: xy.y + xy.h, x2: xy.x + xy.w*0.5, y2: xy.y,
					x3: xy.x  + xy.w, y3: xy.y + xy.h
				}
	return this;
}
Eyebrow.prototype.rightDown = function() {
	var xy = this.xy;
	this.curve = {x1: xy.x, y1: xy.y, x2: xy.x + xy.w*0.5, y2: xy.y + xy.h * 0.5,
				x3: xy.x  + xy.w, y3: xy.y + xy.h
	}
	return this;
}

Eyebrow.prototype.leftDown = function() {
	var xy = this.xy;
	this.curve = {x1: xy.x, y1: xy.y + xy.h, x2: xy.x + xy.w*0.5, y2: xy.y + xy.h * 0.5,
				x3: xy.x  + xy.w, y3: xy.y
			}
	return this;
}

function Eyebrows(left) {
	this.left = left;
	this.right = new Eyebrow({x:left.xy.x + left.xy.w*2, y:left.xy.y, w:left.xy.w, h:left.xy.h, c:left.xy.c});
	this.normal();
}

Eyebrows.prototype.paint = function(ctx) {
	this.left.paint(ctx);
	this.right.paint(ctx);
	return this;
}

Eyebrows.prototype.normal = function() {
	this.left.normal();
	this.right.normal();
	return this;
}

Eyebrows.prototype.up = function() {
	this.left.up();
	this.right.up();
	return this;
}

Eyebrows.prototype.leftUp = function() {
	this.left.up();
	return this;
}

Eyebrows.prototype.rightUp = function() {
	this.right.up();
	return this;
}

Eyebrows.prototype.rightDown = function() {
	this.left.rightDown();
	this.right.leftDown();
	return this;
}

Eyebrows.prototype.leftDown = function() {
	this.left.leftDown();
	this.right.rightDown();
	return this;
}

function Mouth(xy) {
	this.xy = xy;
	this.normal();
}

Mouth.prototype.normal = function() {
	var xy = this.xy;
	this.c1 = {	x1: xy.x, y1: xy.y + xy.h*0.5, 
				x2: xy.x + xy.w*0.5, y2: xy.y + xy.h * 0.6,
				x3: xy.x  + xy.w, y3: xy.y + xy.h*0.5, 
				x4: xy.x + xy.w*0.5, y4: xy.y + xy.h * 0.6 }
	return this;
}

Mouth.prototype.openDown = function() {
	var xy = this.xy;
	this.c1 = {	x1: xy.x, y1: xy.y + xy.h*0.5, 
				x2: xy.x + xy.w*0.5, y2: xy.y + xy.h * 1.0,
				x3: xy.x  + xy.w, y3: xy.y + xy.h*0.5, 
				x4: xy.x + xy.w*0.5, y4: xy.y + xy.h * 0.5 }
	return this;
}

Mouth.prototype.down = function() {
	var xy = this.xy;
	this.c1 = {	x1: xy.x, y1: xy.y + xy.h*0.5, 
				x2: xy.x + xy.w*0.5, y2: xy.y + xy.h * 1.0,
				x3: xy.x  + xy.w, y3: xy.y + xy.h*0.5, 
				x4: xy.x + xy.w*0.5, y4: xy.y + xy.h * 1.0 }
	return this;
}

Mouth.prototype.openUp = function() {
	var xy = this.xy;
	this.c1 = {	x1: xy.x, y1: xy.y + xy.h*0.5, 
				x2: xy.x + xy.w*0.5, y2: xy.y + xy.h * 1.0,
				x3: xy.x  + xy.w, y3: xy.y + xy.h*0.5, 
				x4: xy.x + xy.w*0.5, y4: xy.y + xy.h * 0.5 }
	return this;
}

Mouth.prototype.up = function() {
	var xy = this.xy;
	this.c1 = {	x1: xy.x, y1: xy.y + xy.h*0.5, 
				x2: xy.x + xy.w*0.5, y2: xy.y,
				x3: xy.x  + xy.w, y3: xy.y + xy.h*0.5, 
				x4: xy.x + xy.w*0.5, y4: xy.y }
	return this;
}

Mouth.prototype.openUp = function() {
	var xy = this.xy;
	this.c1 = {	x1: xy.x, y1: xy.y + xy.h*0.5, 
				x2: xy.x + xy.w*0.5, y2: xy.y + xy.h*0.5,
				x3: xy.x  + xy.w, y3: xy.y + xy.h*0.5, 
				x4: xy.x + xy.w*0.5, y4: xy.y }
	return this;
}

Mouth.prototype.open = function() {
	var xy = this.xy;
	this.c1 = {	x1: xy.x, y1: xy.y + xy.h*0.5, 
				x2: xy.x + xy.w*0.5, y2: xy.y + xy.h * 1.0,
				x3: xy.x  + xy.w, y3: xy.y + xy.h*0.5, 
				x4: xy.x + xy.w*0.5, y4: xy.y }
	return this;
}

Mouth.prototype.paint = function(ctx) {
	var xy = this.xy;
	var c1 = this.c1;
	ctx.beginPath();
    ctx.moveTo(c1.x1, c1.y1);
    ctx.quadraticCurveTo(c1.x2, c1.y2, c1.x3, c1.y3);
	ctx.quadraticCurveTo(c1.x4, c1.y4, c1.x1, c1.y1);
    ctx.lineWidth = xy.h*0.1;
    ctx.strokeStyle = xy.c;
    ctx.stroke();
	return this;
}

function Face(xy) {
	this.ebrs = new Eyebrows(new Eyebrow({x:xy.x, y:xy.y, w:xy.w/3, h:xy.w/9, c:"rgb(0,0,0)"}));
	this.eyes = new Eyes(new Eye({x:xy.x, y:xy.y + xy.h/5, w:xy.w/3 , h:xy.h/4.5, c:"rgb(0,0,0)"}));
	this.mout = new Mouth({x:xy.x, y: xy.y + xy.h *0.45, w: xy.w, h: xy.h * 0.45, c:"rgb(0,0,0)"});
}

Face.prototype.paint = function(ctx) {
	this.ebrs.paint(ctx);
	this.eyes.paint(ctx);
	this.mout.paint(ctx);
	return this;
}

Face.prototype.normal = function() {
	this.ebrs.normal();
	this.eyes.lookFront();
	this.mout.normal();
	return this;
}

Face.prototype.blink = function () {
	return [
		{obj : this, fun : function(t) {return (function(){t.eyes.close()})}(this), dur : 0.1},
		{obj : this, fun : function(t) {return (function(){t.eyes.open()})}(this), dur : 0.9}
	];
}

Face.prototype.smile = function () {
	return [
		{obj : this, fun : function(t) {return (function(){
			t.ebrs.up();
			t.mout.down();
		})}(this), dur : 1.0}
	];
}

Face.prototype.sad = function () {
	return [
		{obj : this, fun : function(t) {return (function(){
			t.ebrs.normal();
			t.mout.up();
		})}(this), dur : 1.0}
	];
}

Face.prototype.angry = function () {
	return [
		{obj : this, fun : function(t) {return (function(){
			t.ebrs.rightDown();
			t.mout.openUp();
		})}(this), dur : 1.0}
	];
}

function APlay(ray, cycleTime, loop) {
	this.ray = ray;
	this.cycleTime = cycleTime;
	for(var i = 0; i < this.ray.length; i ++) {
		this.ray[i].frametime = Math.floor(this.ray[i].dur * cycleTime);
		this.ray[i].playtime = this.ray[i].frametime;
	}
	
	this.frameno = 0;
	this.loop = loop;
}

APlay.prototype.play = function(ctx) {
	var complete = false;
	this.frameno++;
	for(var i = 0; i < this.ray.length; i ++) {
		if(this.ray[i].playtime > 0) {
			this.ray[i].playtime--;
			this.ray[i].fun();
			this.ray[i].obj.paint(ctx);
			complete = true;
			break;
		}
	}
	
	if(!complete && this.loop) {
		for(var i = 0; i < this.ray.length; i ++) {
			this.ray[i].playtime = this.ray[i].frametime;
		}
		this.play(ctx);
	}
	return this;
}
	
function MPlayer() {
	this.list = [];
}	

MPlayer.prototype.start = function(fps, ctx) {
	this.beat = 0;
	setInterval(
		function(t){
			return (function(){t.play(ctx)})
		}(this), 1000/fps);
}

MPlayer.prototype.addPlay = function(pl) {
	this.list.push(pl);
	return this;
}

MPlayer.prototype.play = function(ctx) {
	this.beat++
	ctx.fillStyle = "rgb(255,255,255)";
	ctx.fillRect(0, 0, 400, 300);
	for(var i = 0; i < this.list.length; i++) {
		var alist = this.list[i];
		alist.play(ctx);
	}
}

	var cvs = document.getElementById("c");
	var ctx = cvs.getContext("2d");
	
	//new Eyes(new Eye({x:10,y:10,w:10,h:10,c:"rgb(0,0,0)"})).close().open().paint(ctx);
	//new Eyebrows(new Eyebrow({x:10, y:1, w:10, h:6, c:"rgb(0,0,0)"})).normal().leftUp().normal().rightUp().paint(ctx);
	//new Mouth({x:10, y:30, w:30, h:20, c:"rgb(0,0,0)"}).normal().open().openDown().down().up().openUp().paint(ctx);
	var f = new Face({x:10,y:10,w:30,h:45});
	f.paint(ctx);
	var m = new MPlayer();
	m.addPlay(new APlay(f.blink(),40,true))
	//m.addPlay(new APlay(f.smile(),1,true))
	//m.addPlay(new APlay(f.sad(),1,false))
	m.addPlay(new APlay(f.angry(),1,false))
	m.start(10,ctx);
</script>	
</body>
</html>

